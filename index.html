<!DOCTYPE html>
<html>
<head>
  <title>API Homework</title>
  <script src="https://fb.me/react-0.13.3.js"></script>
  <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
  <script type="text/jsx">
    const url = 'https://api.indiegogo.com/1/campaigns.json?api_token=e377270bf1e9121da34cb6dff0e8af52a03296766a8e955c19f62f593651b346'

    function makeRequest (url, callback) {
      var httpRequest;
      if (window.XMLHttpRequest) {
        httpRequest = new XMLHttpRequest();
      }
      httpRequest.onreadystatechange = responseHandler;
      httpRequest.open('GET', url);
      httpRequest.send();
      function responseHandler () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            callback(JSON.parse(httpRequest.responseText));
          } else {
            alert('There was a problem with the request.');
          }
        }
      }
    }

    makeRequest(url, function (data) {
      React.render(<App cards={data.response} />, document.body)
    })

    var App = React.createClass({
      getInitialState(){
        return {
          filterText: ''
        }
      },

      setFilterText(event){
        this.setState({
          filterText: event.target.value
        })
      },

      filterCards(cards, filterText){
        return filterText === '' ? cards : cards.filter(function(card){
          return !~(card.title+card.tagline).indexOf(filterText)
        })
      },

      renderFilter(){
        return (
          <div>
            <input type='text' onChange={this.setFilterText} />
            {'(try w)'}
          </div>
        )
      },

      renderCards(){
        return this.filterCards(this.props.cards, this.state.filterText).map(function(card){
          return (
            <a href={card.web_url}>
              <div>
                <img src={card.baseball_card_image_url} />
                <h2>{card.title}</h2>
                <h3>{card.tagline}</h3>
              </div>
            </a>
          )
        })
      },

      render(){
        return (
          <div>
            {this.renderFilter()}
            {this.renderCards()}
          </div>
        )
      }
    })
  </script>
</head>
<body>
</body>
</html>
